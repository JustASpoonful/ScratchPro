<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modular Scratch Editor</title>
    <style>
        body { font-family: sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; background: #f0f0f2; }
        
        /* Sidebar/Toolbox */
        #toolbox { 
            width: 250px; background: #fff; border-right: 1px solid #ddd; 
            display: flex; flex-direction: column; padding: 10px; overflow-y: auto;
        }
        .category-title { font-weight: bold; margin: 15px 0 5px; font-size: 0.9em; color: #555; }
        
        /* Workspace */
        #workspace { flex-grow: 1; position: relative; padding: 20px; overflow: auto; }

        /* Block Styling */
        .block {
            padding: 10px 15px;
            margin-bottom: 8px;
            border-radius: 4px;
            color: white;
            cursor: grab;
            font-size: 13px;
            font-weight: 500;
            user-select: none;
            display: inline-block;
            white-space: nowrap;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .block:active { cursor: grabbing; }
        
        .workspace-block { position: absolute; z-index: 10; }
    </style>
</head>
<body>

    <div id="toolbox">
        </div>

    <div id="workspace" ondrop="drop(event)" ondragover="allowDrop(event)">
        </div>

    <script src="blocks.js"></script>

    <script>
        // CORE ENGINE LOGIC - DO NOT CHANGE UI
        function allowDrop(ev) { ev.preventDefault(); }

        function drag(ev) {
            ev.dataTransfer.setData("blockType", ev.target.dataset.type);
            ev.dataTransfer.setData("blockColor", ev.target.style.backgroundColor);
            ev.dataTransfer.setData("blockLabel", ev.target.innerText);
        }

        function drop(ev) {
            ev.preventDefault();
            const type = ev.dataTransfer.getData("blockType");
            const color = ev.dataTransfer.getData("blockColor");
            const label = ev.dataTransfer.getData("blockLabel");

            const newBlock = document.createElement("div");
            newBlock.className = "block workspace-block";
            newBlock.style.backgroundColor = color;
            newBlock.innerText = label;
            
            // Positioning logic
            const rect = document.getElementById("workspace").getBoundingClientRect();
            newBlock.style.left = (ev.clientX - rect.left - 20) + "px";
            newBlock.style.top = (ev.clientY - rect.top - 10) + "px";

            document.getElementById("workspace").appendChild(newBlock);
        }

        // Initialize Toolbox from the JS Data
        function initEditor() {
            const toolbox = document.getElementById('toolbox');
            
            // Loop through categories defined in blocks.js
            BLOCK_DATABASE.categories.forEach(cat => {
                const title = document.createElement('div');
                title.className = 'category-title';
                title.innerText = cat.name.toUpperCase();
                toolbox.appendChild(title);

                cat.blocks.forEach(block => {
                    const b = document.createElement('div');
                    b.className = 'block';
                    b.draggable = true;
                    b.innerText = block.label;
                    b.style.backgroundColor = cat.color;
                    b.dataset.type = block.id;
                    b.ondragstart = drag;
                    toolbox.appendChild(b);
                });
            });
        }

        // Run on load
        window.onload = initEditor;
    </script>
</body>
</html>
